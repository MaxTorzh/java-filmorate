![–î–∏–∞–≥—Ä–∞–º–º–∞ Filmorate](images/FilmorateScheme.png)

# Filmorate üé¨

## –û –ø—Ä–æ–µ–∫—Ç–µ

**Filmorate** ‚Äî —ç—Ç–æ REST API –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ñ–∏–ª—å–º–æ–≤ –∏ –ø–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º.  
–ê–Ω–∞–ª–æ–≥ –∫–∏–Ω–æ–ø–æ–∏—Å–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é:

- –î–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ª–∞–π–∫–æ–≤
- –ü–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π –∏ –æ–±—â–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç         | –í–µ—Ä—Å–∏—è                 |
|-------------------|------------------------|
| Java              | 21                     |
| Spring Boot       | 3.2.4                  |
| Lombok            | (–∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ POM) |
| Logbook           | 3.7.2                  |
| Spring Validation | 3.2.4                  |

```xml

<dependency>
    <groupId>org.zalando</groupId>
    <artifactId>logbook-spring-boot-starter</artifactId>
    <version>3.7.2</version>
</dependency>
```

---

# üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- JDK 21+
- Maven 3.9+

**–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫**

```java
mvn clean package
java -
jar target/filmorate-0.0.1-SNAPSHOT.jar
```

---

# üìö API Endpoints

## –§–∏–ª—å–º—ã

| –ú–µ—Ç–æ–¥  | 	–ü—É—Ç—å                      | 	–û–ø–∏—Å–∞–Ω–∏–µ                | 	–í–∞–ª–∏–¥–∞—Ü–∏—è                                                         | 	–ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞                                                                                    |
|--------|----------------------------|--------------------------|--------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| GET    | /films                     | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å–º—ã      | 	-                                                                 | 	-                                                                                                      |
| GET    | /films/{id}                | –ü–æ–ª—É—á–∏—Ç—å —Ñ–∏–ª—å–º –ø–æ ID     | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ID                                          | 	-                                                                                                      |
| POST   | /films                     | –°–æ–∑–¥–∞—Ç—å —Ñ–∏–ª—å–º            | @Valid, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è, –¥–∞—Ç—ã (‚â• 1895-12-28), –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (> 0) | json { "name": "Inception", "description": "A thief...", "releaseDate": "2010-07-16", "duration": 148 } |
| PUT    | 	/films                    | 	–û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å–º          | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID, –Ω–∞–∑–≤–∞–Ω–∏—è, –¥–∞—Ç—ã                                       | 	–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ POST                                                                                        |
| PUT    | 	/films/{id}/like/{userId} | 	–î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫           | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID —Ñ–∏–ª—å–º–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                                 | 	-                                                                                                      |
| DELETE | 	/films/{id}/like/{userId} | 	–£–¥–∞–ª–∏—Ç—å –ª–∞–π–∫            | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID —Ñ–∏–ª—å–º–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                                 | 	-                                                                                                      |
| GET    | 	/films/popular?count={n}  | 	–¢–æ–ø-N —Ñ–∏–ª—å–º–æ–≤ –ø–æ –ª–∞–π–∫–∞–º | 	count > 0 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)                                       | 	-                                                                                                      |

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

| –ú–µ—Ç–æ–¥  | 	–ü—É—Ç—å                                 | 	–û–ø–∏—Å–∞–Ω–∏–µ                    | 	–í–∞–ª–∏–¥–∞—Ü–∏—è                                   | 	–ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞                                                                                           |
|--------|---------------------------------------|------------------------------|----------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| GET    | 	/users                               | 	–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | 	-                                           | 	-                                                                                                             |
| GET    | 	/users/{id}                          | 	–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID                                 | 	-                                                                                                             |
| POST   | 	/users                               | 	–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è        | 	@Valid, email/–ª–æ–≥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã, –∏–º—è ‚â† –ø—É—Å—Ç–æ–µ | 	json { "email": "user@mail.com", "login": "user123", "name": "Thomas A. Anderson", "birthday": "1971-09-13" } |
| PUT    | 	/users                               | 	–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è       | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID, email/–ª–æ–≥–∏–Ω–∞                   | 	–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ POST                                                                                               |
| PUT    | 	/users/{id}/friends/{friendId}       | 	–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∞              | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID, –∑–∞–ø—Ä–µ—Ç —Å–∞–º–æ–¥—Ä—É–∂–±—ã              | 	-                                                                                                             |
| DELETE | 	/users/{id}/friends/{friendId}       | 	–£–¥–∞–ª–∏—Ç—å –¥—Ä—É–≥–∞               | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID                                 | 	-                                                                                                             |
| GET    | 	/users/{id}/friends                  | 	–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π               | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ ID                                 | 	-                                                                                                             |
| GET    | 	/users/{id}/friends/common/{otherId} | 	–û–±—â–∏–µ –¥—Ä—É–∑—å—è                | 	–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–æ–∏—Ö ID                           | 	-                                                                                                             |

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
classDiagram
    direction BT
    
    class FilmController {
        +addLike(id, userId) void
    }
    
    class FilmService {
        -filmStorage: FilmStorage
        +addLike(id, userId) void
    }
    
    class InMemoryFilmStorage {
        -films: Map~Long, Film~
        +save(Film) Film
    }
    
    FilmController --> FilmService
    FilmService --> InMemoryFilmStorage
```

---

# üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## –°–ª–æ–∏:

### Controller:

1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã

2. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (@Valid)

3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP-–æ—Ç–≤–µ—Ç—ã

### Service:

1. –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (–¥—Ä—É–∂–±–∞, –ª–∞–π–∫–∏)

2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

3. –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Storage

### Storage:

1. In-memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (HashMap)

2. –í—ã–ø–æ–ª–Ω—è–µ—Ç CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è:

1. –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (@NotBlank, @Size, @PastOrPresent)

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. –î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞ —Ñ–∏–ª—å–º–∞ ‚â• 28.12.1895 (@MinReleaseDate)

2. –ó–∞–ø—Ä–µ—Ç —Å–∞–º–æ–¥—Ä—É–∂–±—ã –≤ UserService.addFriend()

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:

1. @ExceptionHandler –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:

1. NotFoundException (404)

2. ValidationException (400)

3. DuplicatedDataException (409)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

1. Logbook –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

2. SLF4J –¥–ª—è –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–∑–µ–π, –ª–∞–π–∫–æ–≤)

---

# üí° –ü—Ä–∏–º–µ—Ä—ã

## üßç –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∞ (UserService)

```java
public void addFriend(Long userId, Long friendId) {
    if (userId.equals(friendId)) {
        throw new ValidationException("–ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å —Å–µ–±—è –≤ –¥—Ä—É–∑—å—è");
    }
    User user = userStorage.getById(userId);
    User friend = userStorage.getById(friendId);
    user.getFriends().add(friendId);
    friend.getFriends().add(userId); // –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –¥—Ä—É–∂–±–∞
    userStorage.save(user);
    userStorage.save(friend);
}
```

## –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

```mermaid
sequenceDiagram
    participant Frontend
    participant UserController
    participant UserService
    participant Storage
    
    Frontend->>UserController: PUT /users/1/friends/2
    UserController->>UserService: addFriend(1, 2)
    UserService->>Storage: getById(1)
    Storage-->>UserService: User
    UserService->>Storage: getById(2)
    Storage-->>UserService: User
    UserService->>Storage: save(User)
    UserService->>Storage: save(Friend)
    UserService-->>UserController: OK
    UserController-->>Frontend: 200 OK
```

---

## ‚ù§Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∞–π–∫–∞

```java
public void addLike(Long filmId, Long userId) {
    Film film = filmStorage.getFilmById(filmId);
    if (filmStorage.getFilmById(filmId) == null) {
        throw new NotFoundException("–§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω.");
    }
    User user = userStorage.getUserById(userId);
    if (user == null) {
        throw new NotFoundException("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.");
    }
    film.getLikes().add(userId);
}
```

## –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

```mermaid
sequenceDiagram
    participant User
    participant Controller
    participant Service
    participant Storage
    
    User->>Controller: PUT /films/1/like/101
    Controller->>Service: addLike(1, 101)
    Service->>Storage: getById(1)
    Storage-->>Service: Film
    Service->>Storage: save(Film)
    Storage-->>Service: Film
    Service-->>Controller: OK
    Controller-->>User: 200 OK
```
